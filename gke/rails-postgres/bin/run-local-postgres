#!/bin/sh -e
#
# Run a PostgreSQL database server in a Docker container.
#
# Usage: bin/run-postgres

echo "Starting PostgreSQL server..."
docker run --name=rails-app-postgres -d -p 5432:5432 -e POSTGRES_PASSWORD=postgres postgres:17.6

# Wait until PostgreSQL is ready to accept connections
until docker exec -it rails-app-postgres pg_isready -U postgres; do
  echo "Waiting for PostgreSQL to be ready..."
  sleep 1
done

echo "Creating local database..."
docker exec -it rails-app-postgres psql -U postgres -d postgres -c 'CREATE database app_development'

echo "Creating test database..."
docker exec -it rails-app-postgres psql -U postgres -d postgres -c 'CREATE database app_test'
